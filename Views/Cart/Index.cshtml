
@model OnlineStore.Models.Cart

<head>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" />
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

    <style>
        .quantity {
            width: 40px !important;
        }
    </style>
</head>

<body>

    <table class="table table2">
        <thead>
            <tr>
                <th class="text-center">Quantity</th>
                <th>Product</th>
                <th class="text-right">Delete</th>
                <th class="text-right">Price</th>
                <th class="text-right">Total price</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var line in Model.Lines)
            {
                <tr class="line">
                    <td class="text-center"><input type="number" onkeydown="return false" class="quantity" min="1" value="@line.Quantity" /><input type="hidden" value=@line.Product.Id /></td>
                    <td class="text-left">@line.Product.Name</td>
                    <td class="text-right"><a><img onclick="DeleteItem(this)" class="delete" src="~/Content/img/delete.png" width="20" height="20" /></a></td>
                    <td class="text-right">@line.Product.Price</td>
                    <td class="text-right price1">
                        @(line.Quantity * line.Product.Price)
                    </td>
                </tr>
            }
        </tbody>
        <tfoot>
            <tr>
                <td colspan="4" class="text-right">Total:</td>
                <td class="text-right" id="total">
                    @Model.ComputeTotalValue()
                </td>
            </tr>
        </tfoot>
    </table>
    <script>

        function DeleteItem(e) {
            var _id = e.parentElement.parentElement.parentElement.children[0].children[1].value;
            var path = "RemoveFromCart"
            $.get(path, { id: _id }, function (data) {
                location.reload();
            });

        }

        $(document).ready(function () {

            $(".quantity").change(function () {
                var newValue = parseInt(this.value);
                var old = $(this)[0].parentElement.parentElement.children[0].children[0].defaultValue;
                var _id = $(this)[0].parentElement.parentElement.children[0].children[1].value;

                if (newValue > old) {
                    path = "AddToCart";
                }

                if (newValue < old) {
                    path = "ReduceFromCart";
                }

                var price = $(this)[0].parentElement.parentElement.children[3].innerText;
                var totalElem = $(this)[0].parentElement.parentElement.children[4];
                var count = $(".price1");
                var path;

                $.get(path, { id: _id }, function () {
                    price = price.replace(/,/g, '.');
                    price = parseFloat(price);
                    var totalpr = (parseFloat(newValue) * parseFloat(price));;
                    totalElem.innerText = totalpr.toFixed(2);
                    var sum = 0;
                    for (var i = 0; i < count.length; i++) {
                        sum += parseFloat(count[i].innerText.replace(/,/g, '.'));
                    }
                    document.getElementById("total").innerText = sum.toFixed(2);
                });
            });

        });

    </script>
</body>